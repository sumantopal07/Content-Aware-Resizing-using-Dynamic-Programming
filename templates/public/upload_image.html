{% extends "public/templates/public_template.html" %}

{% block title %}Smart Image Cropping{% endblock %}

{% block main %}

<div class="container">
    <div class="row">
        <div class="col">

            <h1>Smart Image Cropping</h1>
            <hr>

            <form action="/upload_image" method="POST" enctype="multipart/form-data">

                <div class="form-group">
                    <label>Select image (only JPG supported and upto 2 MB)</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" name="image" id="image" oninput="filesize(this);">
                        <label class="custom-file-label" for="image" id="DDD"></label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="uk-form-label">Scale</div>
                    <select class="uk-select" id="scale" name="scale">
                        <option value="0.90">90% (takes around 5 minutes to process)</option>
                        <option value="0.80">80% (takes around 5 minutes to process)</option>
                        <option value="0.75%">75% (takes around 5 minutes to process)</option>
                        <option value="0.50">50% (takes around 5 minutes to process)</option>
                        <option value="0.25">25% (takes around 5 minutes to process)</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="uk-form-label">orientation</div>
                    <select class="uk-select" id="orientation" name="orientation">
                        <option value="c">col-wise</option>
                        <option value="r">row-wise</option>
                    </select>
                </div>

                <center><button id="VVVVV" type="submit" class="btn btn-primary">Upload</button></center>

            </form>
            <hr>
            <br>
            <center>
                <h5 id="BBBBBB">
                    </h3>
            </center>

        </div>
    </div>
</div>

<script type="text/javascript" charset="utf-8">
    console.log("Javascript loaded");
    function filesize(elem) {
        document.cookie = `filesize=${elem.files[0].size}`
    }
    document.querySelector("#image").onchange = function () {
        document.querySelector("#DDD").innerHTML = this.files[0].name;
    }
    //////////////////////////////////////////////////////////////////////////////
    document.getElementById("VVVVV").addEventListener("click", (e) => {
        //e.preventDefault();
        console.log("click me");
        document.querySelector("#BBBBBB").innerHTML = "Initialising... (wait for few seconds)";

        let y;
        function fname() {
            fetch('/loading').then(function (response) {
                return response.json();
            }).then((x) => {
                document.querySelector("#BBBBBB").innerHTML = x.map;
                y = x.map;
                if (y[0] == 'p' || y[0] == 'c')
                    fx();
                console.log(x.map);
            }).catch((error) => {
                console.log(error);

            })
        }
        let refreshIntervalId = setInterval(fname, 10000);
        function fx() {
            clearInterval(refreshIntervalId);
            document.getElementById("VVVVV").disabled=false;
        }
    })

    function fname2() {
        let z=document.querySelector("#BBBBBB").innerHTML;
        if (z.length>0 && (z[0] == 'L' || z[0] == 'p' || z[0]=='I'))
            fx2();
    }
    let refreshIntervalId2 = setInterval(fname2, 50);
    function fx2() {
        document.getElementById("VVVVV").disabled=true;
    }

    // fetch('/a1')
    // .then( res => res.json())
    // .then(x => console.log("response a1="+x.map))

    // fetch('/a2')
    // .then( res => res.json())
    // .then(x => console.log("response a2="+x.map))

    // fetch('/a3')
    // .then( res => res.json())
    // .then((x) => 
    // {
    //     console.log("response a3="+x.map)
    // })
</script>

{% endblock %}