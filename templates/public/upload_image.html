{% extends "public/templates/public_template.html" %}

{% block title %}Upload{% endblock %}

{% block main %}

<div class="container">
    <div class="row">
        <div class="col">

            <h1>Smart Image Cropping</h1>
            <hr>

            <form action="/upload_image" method="POST" enctype="multipart/form-data">

                <div class="form-group">
                    <label>Select image (only JPG supported)</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" name="image" id="image" oninput="filesize(this);">
                        <label class="custom-file-label" for="image" id="DDD"></label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="uk-form-label">Scale</div>
                    <select class="uk-select" id="scale" name="scale">
                        <option value="0.75">0.75</option>
                        <option value="0.25">0.25</option>
                        <option value="0.3">0.3</option>
                        <option value="0.5">0.5</option>
                        <option value="0.8">0.8</option>
                        <option value="0.9">0.9</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="uk-form-label">orientation</div>
                    <select class="uk-select" id="orientation" name="orientation">
                        <option value="r">row-wise</option>
                        <option value="c">col-wise</option>
                    </select>
                </div>

                <center><button id="VVVVV" type="submit" class="btn btn-primary">Upload</button></center>

            </form>
            <center>
                <h3 id="BBBBBB"></h3>
            </center>

        </div>
    </div>
</div>
<script type="text/javascript" charset="utf-8">
    console.log("Javascript loaded");
    function filesize(elem) {
        document.cookie = `filesize=${elem.files[0].size}`
    }
    document.querySelector("#image").onchange = function () {
        document.querySelector("#DDD").innerHTML = this.files[0].name;
    }
    let j = 0;
    //////////////////////////////////////////////////////////////////////////////
    document.getElementById("VVVVV").addEventListener("click", (e) => {
        //e.preventDefault();
        //console.log("click me");

        //for(let i=0;i<=10;i++,j++);console.log(j);

        let y;
        function fname() {
            fetch('/loading').then(function (response) {
                //console.log(response.json());
                return response.json();
            }).then((x) => {
                document.querySelector("#BBBBBB").innerHTML = x.map;
                y = x.map;
                console.log(x.map);
                if (y[0] == 'p')
                    fx();
            }).catch((error) => {
                console.log(error);
            })
        }
        let refreshIntervalId = setInterval(fname, 500);
        function fx() {
            clearInterval(refreshIntervalId);
        }
    })
</script>

{% endblock %}